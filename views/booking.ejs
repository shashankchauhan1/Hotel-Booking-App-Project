<%- include('partials/header') %>

<div class="booking-container">
    <h2>Confirm Your Booking</h2>
    
    <div class="booking-summary">
        <h3><%= hotel.name %></h3>
        <p><%= hotel.location %></p>
        <hr>
        <h4>Room Details</h4>
        <p><strong>Room Type:</strong> <%= room.type %></p>
        <p><strong>Room Number:</strong> <%= room.roomNumber %></p>
        <p><strong>Price per night:</strong> $<%= room.price %></p>
    </div>

    <form action="/api/bookings" method="POST" class="booking-form">
        <input type="hidden" name="hotel" value="<%= hotel._id %>">
        <input type="hidden" name="room" value="<%= room._id %>">
        
        <div class="form-group">
            <label for="checkInDate">Check-in Date</label>
            <input type="date" id="checkInDate" name="checkInDate" required min="<%= new Date().toISOString().split('T')[0] %>">
        </div>
        <div class="form-group">
            <label for="checkOutDate">Check-out Date</label>
            <input type="date" id="checkOutDate" name="checkOutDate" required min="<%= new Date().toISOString().split('T')[0] %>">
        </div>

        <div class="price-calculation">
            <h4>Total Price: $<span id="totalPrice">0.00</span></h4>
            <input type="hidden" name="totalPrice" id="totalPriceInput" value="0">
        </div>

        <button type="submit" class="btn btn-primary">Confirm & Book</button>
    </form>
</div>

<script>
    const checkInInput = document.getElementById('checkInDate');
    const checkOutInput = document.getElementById('checkOutDate');
    const totalPriceSpan = document.getElementById('totalPrice');
    const totalPriceInput = document.getElementById('totalPriceInput');
    const roomPrice = <%= room.price %>

    function calculateTotal() {
        const checkIn = new Date(checkInInput.value);
        const checkOut = new Date(checkOutInput.value);

        if (
            checkInInput.value &&
            checkOutInput.value &&
            checkOut > checkIn
        ) {
            const timeDiff = checkOut.getTime() - checkIn.getTime();
            const days = Math.ceil(timeDiff / (1000 * 3600 * 24));
            const total = days * roomPrice;
            totalPriceSpan.textContent = total.toFixed(2);
            totalPriceInput.value = total;
        } else {
            totalPriceSpan.textContent = '0.00';
            totalPriceInput.value = '0';
        }
    }

    checkInInput.addEventListener('change', calculateTotal);
    checkOutInput.addEventListener('change', calculateTotal);

    // Initial calculation if dates are pre-filled
    window.addEventListener('DOMContentLoaded', calculateTotal);
</script>

<%- include('partials/footer') %>